!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){var r=n(1);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(3)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,'html {\n  position: relative;\n  width: 100%;\n  height: 100%; }\n\nbody {\n  margin: 0;\n  font-size: 1rem;\n  color: #333;\n  font-family: sans-serif;\n  position: absolute;\n  width: 100%;\n  height: 100%; }\n\ninput,\nselect,\nbutton,\ntextarea {\n  font-family: inherit;\n  font-size: inherit;\n  color: inherit;\n  background: rgba(255, 255, 255, 0.85);\n  border: none;\n  outline: none !important;\n  padding: 0.5rem;\n  border-radius: 2px;\n  box-shadow: inset 0px 0px 0px 1px rgba(0, 0, 0, 0.17);\n  max-width: 100%;\n  box-sizing: border-box;\n  display: block;\n  transition: 500ms all; }\n\ninput,\nselect,\ntextarea {\n  width: 100%; }\n\nselect {\n  appearance: none;\n  -webkit-appearance: none; }\n\ninput[type="file"] {\n  box-shadow: none;\n  cursor: pointer; }\n\nbutton {\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 0.5rem 1rem;\n  background: #00bce0;\n  color: #fff;\n  font-weight: bold; }\n\nbutton:hover {\n  background: #00c8ef; }\n\nlabel {\n  display: flex;\n  align-items: center;\n  font-size: 86%;\n  padding: 0.25rem 0px;\n  opacity: 0.75; }\n\nh3,\nh4 {\n  margin: 0.5rem 0px; }\n\n#content {\n  display: flex;\n  height: 100vh;\n  overflow: hidden;\n  width: 100vw; }\n\n#main-content {\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n  overflow: hidden;\n  width: 100vw; }\n\n#sidebar {\n  width: 200px;\n  height: 100%;\n  overflow: auto;\n  background: rgba(75, 80, 82, 0.125);\n  display: flex;\n  flex-direction: column; }\n\n#heading {\n  background: #b6bec1;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  flex-basis: auto;\n  margin-left: -1rem; }\n\n#page-nav {\n  display: flex;\n  align-items: center;\n  justify-content: flex-end; }\n\n.openOuter {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0px;\n  left: 0px;\n  background: rgba(0, 0, 0, 0.7);\n  opacity: 0;\n  pointer-events: none;\n  overflow: auto;\n  padding: 3rem;\n  box-sizing: border-box;\n  transition: opacity 300ms; }\n\n.openOuter.active {\n  opacity: 1;\n  pointer-events: all;\n  z-index: 1; }\n\n.openInner {\n  background: #f3f3f3;\n  padding: 1rem;\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n  justify-content: center;\n  max-width: max-content;\n  min-width: min-content;\n  max-height: max-content;\n  min-height: min-content;\n  margin: auto; }\n\n.pdfRenderer {\n  flex-grow: 1;\n  position: relative;\n  width: 100%;\n  height: 100%;\n  overflow: auto; }\n\n.pdfRenderer .page_container > svg {\n  width: 100%;\n  height: auto;\n  max-width: 800px; }\n\n.page_container {\n  opacity: 0;\n  position: absolute;\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  pointer-events: none;\n  border: none;\n  width: 100%;\n  height: 100%;\n  transition: opacity 300ms; }\n\n[tab-content].active .page_container.active {\n  opacity: 1;\n  pointer-events: all; }\n\n.row {\n  display: flex;\n  align-items: center;\n  padding: 1rem;\n  box-shadow: 0px 1px 0px rgba(0, 0, 0, 0.11); }\n\n#heading .row {\n  padding: 0px;\n  box-shadow: none; }\n\n.grow {\n  flex-grow: 1; }\n\n.setting {\n  width: 100%;\n  padding: 0.5rem 0rem; }\n\n#run.disabled,\n#exportBtn.disabled,\n#sidebar.disabled > .row {\n  opacity: 0.5;\n  pointer-events: none; }\n\n#edit_text.disabled {\n  height: 0px;\n  opacity: 0;\n  overflow: hidden; }\n\n.has-sibling {\n  margin-right: 1rem; }\n\n.section {\n  display: flex;\n  align-items: flex-start;\n  justify-content: stretch;\n  width: calc(100% + 0.25rem);\n  margin: 0.5rem -0.25rem; }\n\n.section > * {\n  margin: 0rem 0.25rem; }\n\n.section-stretch > * {\n  flex-grow: 1; }\n\n.section-equal > * {\n  flex-basis: 0; }\n\n#dbROOT {\n  min-width: 50vw; }\n\n.modifyCollection {\n  display: none; }\n\n.modifyCollection.active {\n  display: block;\n  margin: 2rem 0; }\n\n.modifyCollection button {\n  margin: 0.25rem 0rem; }\n\n.dbSection {\n  width: calc(100% - 0.25rem);\n  margin: 0px 0px 0px 0.25rem; }\n\n.modifyCollection .dbSection {\n  margin: 0px;\n  box-sizing: border-box;\n  padding: 0.125rem 1rem 0.75rem;\n  background: rgba(75, 80, 82, 0.125);\n  box-shadow: inset 0px 0px 0px 1px rgba(75, 80, 82, 0.125); }\n\n.modifyBtn {\n  width: 1.25rem;\n  min-width: 1.25rem;\n  height: 1.25rem;\n  min-height: 1.25rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: #4dbce1;\n  color: #fff;\n  border-radius: 50%;\n  line-height: 1.2rem;\n  font-family: monospace;\n  font-size: 1rem;\n  cursor: pointer;\n  align-self: center; }\n\n.modifyBtn.danger {\n  background: #a82f2f; }\n\n.inputContainer {\n  width: 100%;\n  max-width: 300px; }\n\n.box {\n  background: rgba(75, 80, 82, 0.125);\n  box-shadow: inset 0px 0px 0px 1px rgba(75, 80, 82, 0.125);\n  padding: 0.5rem;\n  border-radius: 2px;\n  margin: 1rem 0rem;\n  box-sizing: border-box;\n  width: calc(100% - 0.5rem); }\n\n#svgEditor-sidebar,\n#preview-sidebar {\n  display: block;\n  min-width: 200px;\n  height: 100%;\n  overflow: auto;\n  background: #b6bec1; }\n\n.sidebar-section {\n  padding: 1vh 2vw;\n  box-shadow: inset 0px 1px 0px 0px #a2abaf; }\n\n#tab-contents {\n  flex-grow: 1;\n  position: relative; }\n\nbutton[tab] {\n  display: flex;\n  align-items: stretch;\n  justify-content: stretch;\n  width: 100%;\n  height: 100%;\n  border-radius: 0px;\n  box-shadow: none;\n  background: transparent;\n  color: #333;\n  padding: 0rem 1rem;\n  height: 4rem;\n  position: relative;\n  flex-direction: column;\n  margin: 0px -1rem;\n  transition: color 0.2s, background-color 0.2s; }\n\nbutton[tab].disabled {\n  opacity: 0.8;\n  pointer-events: none; }\n\nbutton[tab] > span {\n  background: #b6bec1;\n  color: #333;\n  transition: color 0.2s, background-color 0.2s;\n  display: flex;\n  width: 100%;\n  height: 100%;\n  justify-content: center;\n  align-items: center;\n  flex-grow: 1;\n  padding-left: 1rem;\n  box-sizing: border-box; }\n\nbutton[tab]:before,\nbutton[tab]:after {\n  content: "";\n  position: absolute;\n  height: 0px;\n  width: 0px;\n  border: 2rem solid transparent;\n  border-left-color: #b6bec1;\n  border-left-width: 1rem;\n  top: 0px;\n  left: 1rem;\n  transition: border-left-color 0.2s; }\n\nbutton[tab]:after {\n  left: calc(100% - 1rem);\n  z-index: 1; }\n\nbutton[tab]:hover > span {\n  background-color: #9bcadc; }\n\nbutton[tab]:hover::after {\n  border-left-color: #9bcadc; }\n\nbutton[tab].active:hover > span,\nbutton[tab].active > span {\n  background-color: #00bce0;\n  color: #fff; }\n\nbutton[tab].active:hover::after,\nbutton[tab].active::after {\n  border-left-color: #00bce0; }\n\n[tab-content] {\n  opacity: 0;\n  position: absolute;\n  height: 100%;\n  width: 100%;\n  pointer-events: none;\n  transition: opacity 0.2s; }\n\n[tab-content].active {\n  opacity: 1;\n  pointer-events: all; }\n\n.tab-content-inner {\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  display: flex;\n  align-items: start;\n  justify-content: stretch; }\n\n.page-padding {\n  padding: 5vh 5vw; }\n\n.vertical-margin {\n  margin-top: 3vh;\n  margin-bottom: 3vh; }\n\n.vericalPadding {\n  padding-top: 1vh;\n  padding-bottom: 1vh; }\n\n.center-self {\n  align-self: center; }\n\n.max-scroll {\n  height: 100%;\n  width: 100%;\n  overflow: auto;\n  box-sizing: border-box; }\n\n#queryResultsContainer {\n  font-size: 0.85rem;\n  line-height: 0.8rem;\n  max-width: 33vw;\n  min-width: 35rem; }\n  #queryResultsContainer:empty {\n    min-width: 0px;\n    max-width: 0px; }\n\n.json-row {\n  padding: 0.25rem 1rem;\n  display: flex;\n  flex-direction: column;\n  flex-wrap: wrap;\n  font-size: 0.7rem; }\n  .json-row .json-toggler {\n    display: flex;\n    align-items: flex-start; }\n  .json-row .json-children {\n    min-width: 100%;\n    flex-wrap: wrap;\n    max-height: 0px;\n    overflow: hidden; }\n  .json-row.type-array > .json-toggler:before,\n  .json-row.type-object > .json-toggler:before {\n    content: "";\n    border: 0.25rem solid transparent;\n    border-left-color: #00bce0;\n    position: relative;\n    top: 0.21rem;\n    margin-left: -0.25rem; }\n  .json-row.open > .json-children {\n    max-height: unset;\n    overflow: auto; }\n  .json-row.open.type-array > .json-toggler:before,\n  .json-row.open.type-object > .json-toggler:before {\n    border-left-color: transparent;\n    border-top-color: #00bce0;\n    top: 0.25rem; }\n  .json-row.open.type-array > .json-toggler,\n  .json-row.open.type-object > .json-toggler {\n    cursor: pointer; }\n  .json-row .json-key-name {\n    color: #0275bd; }\n  .json-row.type-string > .json-toggler > .json-value {\n    color: #9c9c9c; }\n  .json-row.type-object > .json-toggler > .json-key-name,\n  .json-row.type-array > .json-toggler > .json-key-name {\n    color: #3300ec; }\n  .json-row.type-undefined > .json-toggler > .json-key-name,\n  .json-row.type-null > .json-toggler > .json-key-name {\n    color: #ec8600; }\n  .json-row.type-boolean > .json-toggler > .json-key-name {\n    color: #7fb938; }\n  .json-row.type-number > .json-toggler > .json-key-name {\n    color: #b9387d; }\n\n.previewQueryResult {\n  padding: 0.25rem;\n  margin: 0.25rem 0;\n  background: #c9d1d4;\n  box-shadow: 0px 1px 3px -4px #000;\n  cursor: pointer;\n  border-radius: 2px;\n  transition: color 0.2s, background-color 0.2s; }\n  .previewQueryResult.active {\n    background: #4dbce1;\n    color: #fff;\n    box-shadow: 0px 2px 7px -6px #000; }\n  .previewQueryResult:hover {\n    background: #9bcadc; }\n\n#preview-sidebar h4 {\n  display: flex;\n  align-items: center; }\n  #preview-sidebar h4 button {\n    pointer-events: none;\n    opacity: 0.5;\n    font-size: 0.9rem;\n    padding: 0.25rem 0.5rem;\n    transition: all 0.2s; }\n    #preview-sidebar h4 button.ready {\n      pointer-events: all;\n      opacity: 1; }\n',""])},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var i=(o=r,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),a=r.sources.map(function(e){return"/*# sourceURL="+r.sourceRoot+e+" */"});return[n].concat(a).concat([i]).join("\n")}var o;return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},i=0;i<this.length;i++){var a=this[i][0];null!=a&&(r[a]=!0)}for(i=0;i<e.length;i++){var o=e[i];null!=o[0]&&r[o[0]]||(n&&!o[2]?o[2]=n:n&&(o[2]="("+o[2]+") and ("+n+")"),t.push(o))}},t}},function(e,t,n){var r,i,a={},o=(r=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===i&&(i=r.apply(this,arguments)),i}),s=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var r=function(e,t){return t?t.querySelector(e):document.querySelector(e)}.call(this,e,n);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}}(),u=null,c=0,l=[],f=n(4);function d(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=a[r.id];if(i){i.refs++;for(var o=0;o<i.parts.length;o++)i.parts[o](r.parts[o]);for(;o<r.parts.length;o++)i.parts.push(y(r.parts[o],t))}else{var s=[];for(o=0;o<r.parts.length;o++)s.push(y(r.parts[o],t));a[r.id]={id:r.id,refs:1,parts:s}}}}function p(e,t){for(var n=[],r={},i=0;i<e.length;i++){var a=e[i],o=t.base?a[0]+t.base:a[0],s={css:a[1],media:a[2],sourceMap:a[3]};r[o]?r[o].parts.push(s):n.push(r[o]={id:o,parts:[s]})}return n}function b(e,t){var n=s(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=l[l.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),l.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var i=s(e.insertAt.before,n);n.insertBefore(t,i)}}function g(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=l.indexOf(e);t>=0&&l.splice(t,1)}function v(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var r=function(){0;return n.nc}();r&&(e.attrs.nonce=r)}return m(t,e.attrs),b(e,t),t}function m(e,t){Object.keys(t).forEach(function(n){e.setAttribute(n,t[n])})}function y(e,t){var n,r,i,a;if(t.transform&&e.css){if(!(a="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=a}if(t.singleton){var o=c++;n=u||(u=v(t)),r=w.bind(null,n,o,!1),i=w.bind(null,n,o,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",m(t,e.attrs),b(e,t),t}(t),r=function(e,t,n){var r=n.css,i=n.sourceMap,a=void 0===t.convertToAbsoluteUrls&&i;(t.convertToAbsoluteUrls||a)&&(r=f(r));i&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var o=new Blob([r],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(o),s&&URL.revokeObjectURL(s)}.bind(null,n,t),i=function(){g(n),n.href&&URL.revokeObjectURL(n.href)}):(n=v(t),r=function(e,t){var n=t.css,r=t.media;r&&e.setAttribute("media",r);if(e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}.bind(null,n),i=function(){g(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else i()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=o()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=p(e,t);return d(n,t),function(e){for(var r=[],i=0;i<n.length;i++){var o=n[i];(s=a[o.id]).refs--,r.push(s)}e&&d(p(e,t),t);for(i=0;i<r.length;i++){var s;if(0===(s=r[i]).refs){for(var u=0;u<s.parts.length;u++)s.parts[u]();delete a[s.id]}}}};var h,x=(h=[],function(e,t){return h[e]=t,h.filter(Boolean).join("\n")});function w(e,t,n,r){var i=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=x(t,i);else{var a=document.createTextNode(i),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(a,o[t]):e.appendChild(a)}}},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,r=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var i,a=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(a)?e:(i=0===a.indexOf("//")?a:0===a.indexOf("/")?n+a:r+a.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")})}},function(e,t,n){"use strict";n.r(t);n(0);var r={api:"http://localhost:6977"},i=function(e,t,n){var r=[e];t&&t.toString().split&&(r=[e].concat(t.toString().split(".")));var i=r.reduce(function(e,t){if(void 0===e)return n;if(-1===t.indexOf(".")&&t.indexOf("(")>-1){var r=/\((.*?)\)/g.exec(t),i=(r?r[1]:"").split(",").map(function(e){return e.trim()}),a=t.split("(")[0];if("function"==typeof e[a])return e[a].apply(e,i)}return t?e[t]:e});return void 0===i?n:i},a=function(e){var t="".concat(r.api,"/").concat(i(e,"path","")),n=Object.assign({},{data:void 0,headers:{},method:"POST"},e,{path:t});return new Promise(function(e,t){var r=new XMLHttpRequest;r.open(n.method,n.path,!0),Object.keys(n.headers).forEach(function(e){r.setRequestHeader(e,n.headers[e])}),r.onload=function(){var t=r.responseText;try{t=JSON.parse(t)}catch(e){}return e(t)},r.onerror=function(){return t(r.statusText)},r.send(n.data)})};function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.handler=void 0,this.isUnsubscribed=void 0,this.id=void 0,this.handler=t,this.next=this.next.bind(this),this.error=this.error.bind(this),this.complete=this.complete.bind(this),this.unsubscribe=this.unsubscribe.bind(this),this.isUnsubscribed=!1}var t,n,r;return t=e,(n=[{key:"next",value:function(e){this.handler.next&&!this.isUnsubscribed&&this.handler.next(e)}},{key:"error",value:function(e){this.isUnsubscribed||(this.handler.error&&this.handler.error(e),this.unsubscribe())}},{key:"complete",value:function(){this.isUnsubscribed||(this.handler.complete&&this.handler.complete(),this.unsubscribe())}},{key:"unsubscribe",value:function(){this.isUnsubscribed=!0}}])&&o(t.prototype,n),r&&o(t,r),e}();function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.subscriptions={}}var t,n,r;return t=e,(n=[{key:"_subscribe",value:function(e,t,n){var r=new s("function"==typeof e?{next:e,error:t,complete:n}:e),i="".concat((new Date).getTime(),"_").concat(Object.keys(this.subscriptions).length,"_").concat(Math.round(1e4*Math.random()));return r.id=i,this.subscriptions[i]=r,this._unsubscribe(r)}},{key:"_unsubscribe",value:function(e){var t=this;return function(){return e.unsubscribe(),t.subscriptions[e.id]=null,delete t.subscriptions[e.id],t.subscriptions}}}])&&u(t.prototype,n),r&&u(t,r),e}();function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t,n){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(e,t,n,r){Object.keys(e).forEach(function(i){(0,e[i][t])(n,r)})},m=function(e){function t(e,n){var r,i,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=this,(r=!(a=b(t).call(this))||"object"!==l(a)&&"function"!=typeof a?d(i):a).noInit=void 0,r.state=void 0,r.previousState=void 0,r.subscribe=r.subscribe.bind(d(r)),r.noInit=n,r.state=e,r}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,c),n=t,(r=[{key:"next",value:function(e){if("function"==typeof this.state)return v(this.subscriptions,"next",this.state);"function"==typeof e&&(e=e(this.state)),this.previousState=this.state,this.state=e,v(this.subscriptions,"next",this.state,this.previousState)}},{key:"error",value:function(e){v(this.subscriptions,"error",e)}},{key:"complete",value:function(){v(this.subscriptions,"complete",void 0)}},{key:"subscribe",value:function(e,n,r){return this.noInit||void 0===this.value||e(this.value),p(b(t.prototype),"_subscribe",this).call(this,e,n,r)}},{key:"value",get:function(){return this.state}},{key:"previous",get:function(){return this.previousState}}])&&f(n.prototype,r),i&&f(n,i),t}(),y=["sans-serif","serif","monospace"],h={tabs:{},tabContent:{}};Array.from(document.body.querySelectorAll("button[tab]")).forEach(function(e){return h.tabs[e.getAttribute("tab")]=e}),Array.from(document.body.querySelectorAll("[tab-content]")).forEach(function(e){return h.tabContent[e.getAttribute("tab-content")]=e});var x=function(e){return e.selectedOptions[0]?e.selectedOptions[0].value:void 0},w=function(e){Object.keys(h.tabs).forEach(function(t){e===t?(h.tabs[t].classList.add("active"),h.tabContent[t].classList.add("active")):(h.tabs[t].classList.remove("active"),h.tabContent[t].classList.remove("active"))})},j=function(e){e.value="",e.removeAttribute("value");var t=Array.from(e.querySelectorAll("option"));t.length&&t.forEach(function(e){return e.removeAttribute("selected")})},C=function(e){e||(e={});var t=new m(e.fontFamily),n=new m(e.fontSize),r=new m(e.letterSpacing),i=new m(e.color),a={get fontFamily(){return t.value},set fontFamily(e){-1!==y.indexOf(e)&&e!==t.value&&t.next(e)},get fontSize(){return n.value},set fontSize(e){(e=parseFloat(e))!==n.value&&n.next(e)},get letterSpacing(){return r.value},set letterSpacing(e){(e=parseFloat(e))!==r.value&&r.next(e)},get color(){return i.value},set color(e){"string"==typeof e&&e!==i.value&&i.next(e)}};return{fontFamily:t,fontSize:n,letterSpacing:r,color:i,styles:a}},E=function(e,t){var n=new m(e.x),r=new m(e.y),i=new m(e.w||"auto"),a=new m(e.h||"auto"),o=new m(e.href),s=new m(e.text),u=C(e.styles),c=u.styles,l=function(){var t=document.getElementById(e.parentId),n=e.element;return n||(t?t.contentWindow.document.getElementById(e.id):void 0)},f=function(e,t,n){return e?"href"===t?e.setAttributeNS(null,t,n):isNaN(parseInt(n))?void 0:e.setAttributeNS(null,t,n):void 0},d=function(e,t){return e?e.textContent=t:void 0};return i.subscribe(t),a.subscribe(t),n.subscribe(t),r.subscribe(t),o.subscribe(t),s.subscribe(t),u.fontFamily.subscribe(t),u.fontSize.subscribe(t),u.letterSpacing.subscribe(t),u.color.subscribe(t),{tag:e.tag,id:e.id,parentId:e.parentId,getElement:l,get w(){return i.value},set w(e){e!==i.value&&(i.next(e),f(l(),"width",e))},get h(){return a.value},set h(e){e!==a.value&&(a.next(e),f(l(),"height",e))},get x(){return n.value},set x(e){e=parseFloat(e),isNaN(e)||e===n.value||(n.next(e),f(l(),"x",e))},get y(){return r.value},set y(e){e=parseFloat(e),isNaN(e)||e===r.value||(r.next(e),f(l(),"y",e))},get href(){return o.value},set href(e){e!==o.value&&(o.next(e),f(l(),"href",e))},get text(){return s.value},set text(e){e!==s.value&&(s.next(e),d(l(),e))},get styles(){return c},set styles(e){e&&Object.keys(c).forEach(function(t){e.hasOwnProperty(t)&&e[t]!==c[t]&&(c[t]=e[t])})},initElement:function(){f(l(),"width",i.value),f(l(),"height",a.value),f(l(),"x",n.value),f(l(),"y",r.value),o.value&&f(l(),"href",o.value),s.value&&d(l(),s.value)},subscribeStyles:function(e){var t=function(){return e(c)};return{fontFamilySub:u.fontFamily.subscribe(t),fontSizeSub:u.fontSize.subscribe(t),letterSpacingSub:u.letterSpacing.subscribe(t),colorSub:u.color.subscribe(t)}}}},P=function(e,t){var n=new m(e.file),r={};return Object.keys(e.elements).forEach(function(n){r[n]=E(e.elements[n],t)}),{get file(){return n.value},set file(e){"string"==typeof e&&e!==n.value&&n.next(e)},id:e.id,get elements(){return r},addElement:function(e){r[e.id]=E(e,t)}}},S="clarence",k=function(e){var t,n,r,i=new m((new Date).getTime()),o=function(e){return e?{pages:e.pages,tab:e.tab,currentPage:e.currentPage,data:e.data,name:e.name,styles:e.styles}:""},s=function(){return JSON.stringify(o(r))};function u(){clearTimeout(t),t=setTimeout(function(){localStorage.setItem(S,s()),console.log("saved project locally")},500)}function c(){clearTimeout(n),n=setTimeout(function(){a({path:"project/save",data:s()}).then(function(){console.log("saved project on server"),i.next((new Date).getTime())})},500)}var l=new m(e.pages.map(function(e){return P(e,u)})),f=new m(e.tab),d=new m(e.currentPage),p=new m(e.data),b=new m(e.name),g=e.styles&&Object.keys(e.styles).length?e.styles:{fontFamily:"sans-serif",fontSize:12,letterSpacing:3,color:"#333"},v=C(g),y=v.styles,h=function(e){return"".concat(e,"_").concat(Object.keys(r.subscriptions).length,"_").concat((new Date).getTime())},x=function(e,t,n){var i=h(n);return r.subscriptions[i]=t(e),r.subscriptions[i]};return(r={subscribeTo:x,get pages(){return l.value},set pages(e){var t=e,n=l.value;try{t=JSON.stringify(t),n=JSON.stringify(n)}catch(e){}t!==n&&(l.next([]),e.forEach(function(e){return r.pushPage(e)}))},pushPage:function(e){var t=P(e,u),n=l.value;n.push(t),l.next(n)},subscribePages:function(e){return x(e,l.subscribe,"pages")},get currentPage(){return d.value},set currentPage(e){e=parseInt(e),isNaN(e)||e<1||e>l.value.length||e!==d.value&&d.next(e)},getCurrentPage:function(){return r.pages[r.currentPage-1]},subscribeCurrentPage:function(e){return x(e,d.subscribe,"currentPage")},get data(){return p.value},set data(e){var t=e,n=p.value;try{t=JSON.stringify(e),n=JSON.stringify(p.value)}catch(e){}t!==n&&p.next(e)},subscribeData:function(e){return x(e,p.subscribe,"data")},get styles(){return y},set styles(e){e&&Object.keys(y).forEach(function(t){e.hasOwnProperty(t)&&e[t]!==y[t]&&(y[t]=e[t])})},subscribeStyles:function(e){var t=function(){return e(y)};return{fontFamily:x(t,v.fontFamily.subscribe,"stylesObj.fontFamily"),fontSize:x(t,v.fontSize.subscribe,"stylesObj.fontSize"),letterSpacing:x(t,v.letterSpacing.subscribe,"stylesObj.letterSpacing"),color:x(t,v.color.subscribe,"stylesObj.color")}},get name(){return b.value},set name(e){"string"==typeof e&&(e=e.trim())!==b.value&&b.next(e)},subscribeName:function(e){return x(e,b.subscribe,"name")},get tab(){return f.value},set tab(e){e!==f.value&&f.next(e)},subscribeTab:function(e){return x(e,f.subscribe,"name")},subscribeServerSave:function(e){return x(e,i.subscribe,"name")},save:function(){return u()},saveServer:function(){return c()},saveAsServer:function(){return c()},clear:function(){localStorage.removeItem(S),Object.keys(r.subscriptions).forEach(function(e){return r.subscriptions[e]()}),r.renderer&&r.renderer.dispose()},initSubject:new m(r,!0),initialized$:function(e){return x(e,r.initSubject.subscribe,"initSubject")},subscriptions:{},getTempState:function(e){var t={},n=[];Object.keys(r.styles).forEach(function(e){return t[e]=r.styles[e]}),r.pages.forEach(function(t){var r={};Object.keys(t.elements).forEach(function(n){var i={},a=t.elements[n];Object.keys(a.styles).forEach(function(e){return i[e]=a.styles[e]});var o=function(e,t,n){return e?"href"===t?e.setAttributeNS(null,t,n):isNaN(parseInt(n))?void 0:e.setAttributeNS(null,t,n):void 0},s={initElement:function(){var e=function(){var e=document.getElementById(a.parentId);if(e)return e.contentWindow.document.getElementById(a.id)}();e&&(o(e,"width",a.w),o(e,"height",a.h),o(e,"x",a.x),o(e,"y",a.y),a.href&&o(e,"href",a.href),a.text&&(e.textContent=s.text))}};"text"===a.tag&&(s.text=a.text,e&&e[a.text]&&(s.text=e[a.text])),r[n]=Object.assign({},t.elements[n],{styles:i},s)}),n.push(Object.assign({},t,{elements:r}))});var i=1,a={renderer:void 0,pages:n,get currentPage(){return i},set currentPage(e){i=parseInt(e)},styles:t,save:function(){},clear:function(){Object.keys(a.subscriptions).forEach(function(e){return a.subscriptions[e]()}),a.renderer&&a.renderer.dispose()},subscriptions:{},subscribeTo:function(e,t,n){var r=h(n);return a.subscriptions[r]=t(e),a.subscriptions[r]},getCurrentPage:function(){return n[a.currentPage-1]},export:function(){}};return a},export:function(){}}).subscribePages(u),r.subscribeCurrentPage(u),r.subscribeData(u),r.subscribeName(u),r.subscribeTab(u),r.subscribeStyles(u),r},O=function(e){return new Promise(function(t){var n=localStorage.getItem(S);if(!n)return t(k("string"==typeof e||void 0===e?{pages:[],currentPage:1,data:{},styles:{fontFamily:"san-serif",fontSize:"12px",letterSpacing:"3px",color:"#333"},name:e||"",tab:Object.keys(h.tabs)[0]}:e));var r=JSON.parse(n);return t(k(r))})};var N=function(e){var t=document.createElement(e.tag);return e.attributes&&Object.keys(e.attributes).forEach(function(n){t[n]=e.attributes[n]}),e.events&&Object.keys(e.events).forEach(function(n){t.addEventListener(n,function(r){e.events[n](t,r)})}),e.parent&&"function"==typeof e.parent.appendChild&&e.parent.appendChild(t),e.run&&e.run(t),t};var F=function(e){e.parent&&"function"==typeof e.parent.appendChild&&(e.empty&&e.parent.appendChild(N({tag:"option",attributes:{textContent:e.empty,value:""}})),e.values.forEach(function(t){var n=e.value===t,r={textContent:t,value:t,selected:n};n&&(r.selected=n),e.parent.appendChild(N({tag:"option",attributes:r}))}))},L=function(e,t,n){if(n=Object.assign({},{preventDefault:!1,stopPropagation:!1,useCapture:!1},n),e&&t){var r,i,a={},o=function(e){if(0===Object.keys(a).length)return s();var t,o;n.preventDefault&&e.preventDefault(),n.stopPropagation&&e.stopPropagation(),i=r,r=e,t="next",o=e,Object.keys(a).forEach(function(e){return a[e][t](o)})},s=function(){e.removeEventListener(t,o,n.useCapture)},u=function(e){return function(){a[e]=null,delete a[e],0===Object.keys(a).length&&s()}};return{get value(){return r},get previous(){return i},dispose:function(){s(),Object.keys(a).forEach(function(e){a[e].complete(),u(e)})},subscribe:function(r,i,s){if("function"==typeof r||"function"==typeof i||"function"==typeof s){var c=Object.assign({},{next:function(){},complete:function(){}},{next:r,complete:s},{id:"".concat((new Date).getTime(),"_").concat(Object.keys(a).length,"_").concat(Math.round(1e4*Math.random()))});return a[c.id]=c,e.removeEventListener(t,o,n.useCapture),e.addEventListener(t,o,n.useCapture),u(c.id)}}}}},B=function(e,t){var n={element:function(e){return n[e].element},subscribe:function(e){return n[e].subscribe},reset:function(){Object.keys(n).forEach(function(e){"function"!=typeof e&&e.subscribe&&"function"==typeof e.subscribe&&e.subscribe.complete()})}};return e.forEach(function(e){var r=document.getElementById(e.id),i=e.event?L(r,e.event):void 0;n[e.id]={element:r,subscribe:e.event?function(n){return t.subscribeTo(n,i.subscribe,e.id)}:void 0}}),n},I=function(e,t){var n=B([{id:"projectName",event:"input"},{id:"newProjectBtn",event:"click"},{id:"openProjectBtn",event:"click"},{id:"saveProjectBtn",event:"click"},{id:"saveProjectAsBtn",event:"click"},{id:"openProjectSelect",event:"click"},{id:"existingProjects",event:"click"},{id:"currentProject",event:"click"}],e);return e.subscribeServerSave(function(){return a({path:"project/list"}).then(function(e){var t=n.element("openProjectSelect"),r=n.element("existingProjects");t.innerHTML="",F({values:e.map(function(e){return e.name}),parent:t}),0===e.length?r.style.display="none":r.style.removeProperty("display")})}),e.subscribeName(function(e){n.element("projectName").value=e,e?(Object.keys(h.tabs).forEach(function(e){h.tabs[e].classList.remove("disabled"),h.tabContent[e].classList.remove("disabled")}),n.element("currentProject").style.removeProperty("display")):(Object.keys(h.tabs).forEach(function(e,t){0===t?(h.tabs[e].classList.add("active"),h.tabContent[e].classList.add("active")):(h.tabs[e].classList.remove("active"),h.tabContent[e].classList.remove("active"),h.tabs[e].classList.add("disabled"),h.tabContent[e].classList.add("disabled"))}),n.element("currentProject").style.display="none")}),n.subscribe("projectName")(function(t){return e.name=t.target.value}),n.subscribe("newProjectBtn")(function(){e.clear(),O("New project").then(t)}),n.subscribe("openProjectBtn")(function(){var r=x(n.element("openProjectSelect"));r&&(e.clear(),a({path:"project/open",data:r}).then(O).then(t))}),n.subscribe("saveProjectBtn")(e.saveServer),n.subscribe("saveProjectAsBtn")(e.saveServer),n},D=function(e,t){var n=!!e&&e.length,r=!!n&&(Array.isArray(t)?t.indexOf(e[0].type)>-1:e[0].type===t);return n&&r},A=function(e){return{subscribe:function(t,n){e[t]||(e[t]=[]),e[t].push(n)},trigger:function(t,n){e[t]&&e[t].forEach(function(e){return e(n)})}}};function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _=function(e,t,n){var r=function(e){return function(t){var n=e.getBoundingClientRect(),r=t.clientX<=n.left+5&&t.clientX>=n.left,i=t.clientX<=n.right&&t.clientX>=n.right-5,a=r||i;e.DragData={x:t.clientX,y:t.clientY,dragging:!a,onLeft:r},e.ownerDocument.addEventListener("mousemove",e._drag),e.ownerDocument.addEventListener("mouseleave",e._endDrag),e.ownerDocument.addEventListener("mouseup",e._endDrag)}}(e);e._drag=function(e){return function(r){r.preventDefault();var i=e.getBoundingClientRect(),a=n.getBoundingClientRect(),o=n.getAttribute("viewBox").split(" "),s=parseFloat(o[3])/a.height,u=parseFloat(e.getAttributeNS(null,"y")||0),c=parseFloat(e.getAttributeNS(null,"x")||0),l=u-(e.DragData.y-r.clientY)*s,f=(e.DragData.x-r.clientX)*s,d=c-f;if(e.DragData.y=r.clientY,e.DragData.x=r.clientX,e.DragData.dragging)t.x=d,t.y=l;else{var p=i.width*s-(e.DragData.onLeft?-f:f);t.w=p,e.DragData.onLeft&&(t.x=d)}}}(e),e._endDrag=function(e){return function(){e.ownerDocument.removeEventListener("mousemove",e._drag),e.ownerDocument.removeEventListener("mouseleave",e._endDrag),e.ownerDocument.removeEventListener("mouseup",e._endDrag)}}(e),e.addEventListener("mousedown",r)},T=function(e,t,n){var r,i=function(e){return e.contentWindow.document},o=function(e){return"iframe_".concat(e)},s=function(e){var t=document.getElementById(o(e));return t?i(t):void 0},u=function(e){return"svg_page_".concat(e)},c=function(t){return function(t){return e.pages.map(function(e){return e.id}).indexOf(t)+1}(t)===e.currentPage},l={},f="\n        body{margin:0px;}\n        body>svg{width:100%;height:auto}\n        svg .".concat("svg_page_element",".active,\n        svg .").concat("svg_page_element","{cursor:pointer;}\n        svg .").concat("svg_page_element",":hover{\n            outline:#4dbce1;outline-style:dotted;outline-offset:-1px;outline-width:2px;\n        }"),d=function(e){var t=b.getActivePageElement();return e.target!==t&&b.unsetActiveElement(t)},p={},b={pageContainerId:o,pageContainerDoc:i,svgId:u,getPageDoc:s,activeElementDocument:void 0,activatingElement:!1,dispose:function(){t.innerHTML="",n&&(n.innerHTML="")},currentPageElement:function(){return e.getCurrentPage()?document.getElementById(o(e.getCurrentPage().id)):void 0},currentPageSvg:function(){return i(b.currentPageElement()).getElementById(u(e.getCurrentPage().id))},setCurrentPage:function(){Array.from(t.querySelectorAll("iframe.".concat("page_container"))).forEach(function(e){c(e.id.split("iframe_")[1])?e.classList.add("active"):e.classList.remove("active")})},unsetActiveElement:function(e){b.activeElementDocument.removeEventListener("click",d,!1),!b.activatingElement&&n&&(n.innerHTML=""),e&&e.classList.remove("active")},setActiveElement:function(r){if(n){var a,o=function(e){var t="fontFamily"===e?"select":"input",i=r.styles.hasOwnProperty(e),a=["fontSize","letterSpacing"].indexOf(e)>-1?"number":"text",o=(i?r.styles[e]:r[e])||"",s="fontFamily"===e?void 0:{type:a,value:o,min:"0"},u=i?"fontFamily"===e?function(e){return r.styles.fontFamily=x(e)}:function(t){return r.styles[e]=t.value}:function(t){return r[e]=t.value},c="".concat(e.charAt(0).toUpperCase()).concat(e.slice(1)).match(/[A-Z][a-z]+/g).map(function(e,t){return t?e.toLowerCase():"".concat(e.charAt(0).toUpperCase()).concat(e.slice(1))}).join(" "),l="fontFamily"!==e?void 0:function(e){return F({parent:e,empty:"Select font",values:y,value:r.styles.fontFamily})};return N({parent:n,tag:"div",attributes:{className:"inputContainer vertical-margin"},run:function(e){N({parent:e,tag:"label",attributes:{textContent:c}}),N({parent:e,tag:t,events:{input:u},attributes:s,run:l})}})};Array.from(t.querySelectorAll("iframe.".concat("page_container"))).forEach(function(e){return Array.from(i(e).querySelectorAll(".".concat("svg_page_element"))).forEach(function(e){e.id===r.id?(e.classList.add("active"),a=e):e.classList.remove("active")})}),a&&(b.activatingElement=!0,n.innerHTML="","text"===a.tagName.toLowerCase()&&(o("text"),Object.keys(e.styles).forEach(o)),requestAnimationFrame(function(){b.activeElementDocument=a.ownerDocument,b.activeElementDocument.addEventListener("mousedown",d,!1),b.activatingElement=!1}))}},getAllPageElements:function(e){return s(e.id)?Array.from(s(e.id).querySelectorAll(".".concat("svg_page_element"))):[]},getActivePageElement:function(){return i(b.currentPageElement()).querySelector(".".concat("svg_page_element",".active"))},getPageElement:function(e){if(e&&e.parentId){var t=i(document.getElementById(e.parentId));if(t)return t.getElementById(e.id)}},renderPageAndSetCurrent:function(e){return b.renderPage(e).then(b.setCurrentPage)},renderPage:function(e){if(!e)return Promise.reject("no pages");var n=function(n){var r=e.id,a=document.getElementById(o(r)),s=document.createElement("style"),c=document.createElement("iframe"),l=u(r),d=(new DOMParser).parseFromString(n,"application/xml");a&&a.parentElement.removeChild(a),s.innerHTML=f,c.id=o(r),c.className="page_container",t.appendChild(c),i(c).head.appendChild(s),i(c).body.appendChild(c.ownerDocument.importNode(d.documentElement,!0));var p=i(c).body.querySelector("svg");return p.id=l,Object.keys(e.elements).forEach(function(t){return b.renderPageElement(e.elements[t],e)}),p};return l[e.id]?Promise.resolve(n(l[e.id])):a({path:e.file}).then(function(t){return l[e.id]=t,n(l[e.id])})},renderPageElement:function(t,n){var r="http://www.w3.org/2000/svg",a=i(document.getElementById(o(n.id))).getElementById(u(n.id)),s="image"===t.tag?document.createElementNS(r,"image"):document.createElementNS(r,"text");s.classList.add("svg_page_element"),s.id=t.id,s.addEventListener("mousedown",function(){b.activatingElement=!0}),s.addEventListener("click",function(e){e.preventDefault(),b.setActiveElement(t)}),a.appendChild(s),t.initElement(),_(s,t,a,e.save);var c=t.subscribeStyles(function(){b.applyStyles(t)});return b.applyStyles(t),Object.keys(c).forEach(function(n){return e.subscriptions["subscribeStyles_".concat(t.id,"_").concat(n)]=c[n]}),s},render:function(){b.renderPage(e.getCurrentPage()).then(function(){b.setCurrentPage()}).catch(console.log)},applyStyles:function(e){b.applyGlobalStyles(e),b.applyElementStyles(e)},applyElementStyles:function(e){e&&(clearTimeout(p[e.id]),p[e.id]=setTimeout(function(){var t=b.getPageElement(e);t&&Object.keys(e.styles).forEach(function(n){var r=e.styles[n];r&&(t.style["color"===n?"fill":n]=["letterSpacing","fontSize"].indexOf(n)>-1?"".concat(parseInt(r),"px"):r)})},66))},applyGlobalStyles:function(){clearTimeout(r),r=setTimeout(function(){var t=e.getCurrentPage();if(t){var n=b.getAllPageElements(t);Object.keys(e.styles).forEach(function(r){return n.forEach(function(n){var i=t.elements[n.id].styles[r];if(""===i||void 0===i){var a=e.styles[r];n.style["color"===r?"fill":r]=["letterSpacing","fontSize"].indexOf(r)>-1?"".concat(parseInt(a),"px"):a}})})}},66)}};return b};function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var R=function(e,t){var n,r=document.body.querySelector(e),i=r.querySelector(".cancelBtn"),a=r.querySelector(".goBtn"),o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){M(e,t,n[t])})}return e}({open:function(){r.classList.add("active"),o.trigger("open")},close:function(){r.classList.remove("active"),o.trigger("close")},get isOpen(){return r.classList.contains("active")}},A({}));return i&&i.addEventListener("click",o.close),a&&a.addEventListener("click",o.close),t&&(n=document.body.querySelector(t)),n&&n.addEventListener("click",o.open),o};function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var U,Q,J,V,H=function(e,t,n,r){var i=e.getCurrentPage(),a=document.getElementById(e.renderer.pageContainerId(i.id)),o=e.renderer.pageContainerDoc(a),s=a.getBoundingClientRect(),u=o.getElementById(e.renderer.svgId(i.id)),c=u.getBoundingClientRect(),l=u.getAttribute("viewBox").split(" "),f=parseFloat(l[3])/c.height,d=s.top-a.contentWindow.scrollY,p=(s.width/2-s.left-n/2)*f,b=(s.height/2-d-r/2)*f,g={id:"image_".concat((new Date).getTime(),"_").concat(Math.round(1e3*Math.random())),parentId:e.renderer.pageContainerId(i.id),href:t,tag:"image",x:p,y:b,w:n,h:"auto",styles:{}};e.getCurrentPage().addElement(g),requestAnimationFrame(function(){var t=e.getCurrentPage(),n=t.elements[g.id];e.renderer.renderPageElement(n,t)})},$=function(e){var t=e.getCurrentPage(),n=document.getElementById(e.renderer.pageContainerId(t.id)),r=e.renderer.pageContainerDoc(n),i=n.getBoundingClientRect(),a=r.getElementById(e.renderer.svgId(t.id)),o=a.getBoundingClientRect(),s=a.getAttribute("viewBox").split(" "),u=parseFloat(s[3])/o.height,c=i.top-n.contentWindow.scrollY,l={id:"text_".concat((new Date).getTime(),"_").concat(Math.round(1e3*Math.random())),parentId:e.renderer.pageContainerId(t.id),text:"replacement_variable",tag:"text",x:(i.width/2-i.left)*u,y:(i.height/2-c)*u,styles:{}};e.getCurrentPage().addElement(l),requestAnimationFrame(function(){var t=e.getCurrentPage(),n=t.elements[l.id];e.renderer.renderPageElement(n,t)})},X=(U="#selectImg",Q=!1,J=document.body.querySelector(U),(V=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){q(e,t,n[t])})}return e}({clear:function(){return Q=!1,j(J)}},A({}))).getFile=function(e){return new Promise(function(t,n){if(!e||!e.target||!D(e.target.files,["image/jpeg","image/jpg","image/png"])){var r="Invalid file";return V.trigger("error",r),V.clear(),n(r)}Q=!0;var i=e.target.files[0],a=new FileReader;a.onload=function(){var e=new Image;e.onload=function(){return V.trigger("file",e),V.clear(),t(e)},e.onerror=function(){return V.trigger("error","Invalid image"),V.clear(),n("Invalid image")},e.src=a.result},a.readAsDataURL(i)})},J.addEventListener("input",V.getFile),J.addEventListener("blur",function(e){if(e.target.files.length&&!Q)return V.getFile(e)}),V),G=function(e){var t=!1,n=document.body.querySelector(e),r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){z(e,t,n[t])})}return e}({clear:function(){return t=!1,j(n)}},A({}));return r.getFile=function(e){return new Promise(function(n,i){if(!e||!e.target||!D(e.target.files,"application/pdf")){var a="Invalid file";return r.trigger("error",a),r.clear(),i(a)}t=!0;var o=e.target.files[0],s=new FormData;return s.append("file",o),r.trigger("file",s),r.clear(),n(s)})},n.addEventListener("input",r.getFile),n.addEventListener("blur",function(e){if(e.target.files.length&&!t)return r.getFile(e)}),r}("#selectSVG"),W=R("#selectSVGPopup"),Y=R("#selectImgPopup"),Z=function(e){var t=B([{id:"svgEditor"},{id:"editContentContainer"},{id:"selectSVGPopup"},{id:"selectSVG"},{id:"pageCount"},{id:"pageNumberInput",event:"input"},{id:"addPagesBtn",event:"click"},{id:"deletePageBtn",event:"click"},{id:"addImageBtn",event:"click"},{id:"addTextBtn",event:"click"},{id:"fontFamily",event:"input"},{id:"fontSize",event:"input"},{id:"letterSpacing",event:"input"},{id:"color",event:"input"}],e),n=function(t){return function(n){return e.styles[t]=n.target.value}},r=function(n){var r=e.pages[n-1];e.renderer&&r&&e.renderer.renderPageAndSetCurrent(r),t.element("pageNumberInput").value=n};return t.subscribe("pageNumberInput")(function(t){return e.currentPage=t.target.value}),t.subscribe("addPagesBtn")(W.open),t.subscribe("deletePageBtn")(function(){}),t.subscribe("addTextBtn")(function(){return $(e)}),t.subscribe("addImageBtn")(Y.open),t.subscribe("fontFamily")(n("fontFamily")),t.subscribe("fontSize")(n("fontSize")),t.subscribe("letterSpacing")(n("letterSpacing")),t.subscribe("color")(n("color")),e.subscribePages(function(n){t.element("pageCount").textContent=n.length,t.element("pageNumberInput").setAttribute("max",n.length),r(e.currentPage)}),e.subscribeCurrentPage(r),G.subscribe("file",function(t){W.close(),a({path:"project/addpage/".concat(e.name),data:t}).then(function(t){t.forEach(e.pushPage),W.close()})}),G.subscribe("error",function(e){console.log(e),W.close()}),X.subscribe("file",function(t){Y.close(),H(e,t.src,t.width,t.height)}),X.subscribe("error",function(e){Y.close(),console.log(e)}),e.subscribeTab(function(n){"template"===n&&(e.renderer&&e.renderer.dispose(),e.renderer=T(e,t.element("svgEditor"),t.element("editContentContainer")),e.subscribeStyles(function(n){e.renderer.applyGlobalStyles(n),Object.keys(n).forEach(function(e){switch(e){case"fontFamily":t.element("fontFamily").value=n.fontFamily;break;case"color":t.element("color").value=n.color;break;default:t.element(e).value=parseInt(n[e])}})}),e.renderer.render())}),t},K=function(e){var t=B([{id:"runQuery",event:"click"},{id:"queryResultsContainer"},{id:"queryContainer"}],e);return t.subscribe("runQuery")(function(){e.DB.runQuery().then(function(e){var n='<div style="padding: 0.5rem 1rem;">Claims: '.concat(e.length,"</div><pre>").concat(JSON.stringify(e,null,2),"</pre>");t.element("queryResultsContainer").innerHTML=n}).catch(console.log)}),t},ee=function(e){var t,n,r=function(e){t&&t.reset(),t=B([{id:"testPdfBtn",event:"click"},{id:"pageNumberInputPreview",event:"input"},{id:"svgEditorPreview"},{id:"previewQueryResults"},{id:"pageCountPreview"}],e)};r(e),e.subscribeTab(function(i){if("preview"!==i)return t.element("testPdfBtn").classList.remove("ready");e.renderer&&e.renderer.dispose();var a=function(i){n&&n.clear(),n=e.getTempState(i);var a=function(e){var r=n.pages[e-1];n.renderer&&r&&n.renderer.renderPageAndSetCurrent(r),t.element("pageNumberInputPreview").value=e};n.renderer=T(n,t.element("svgEditorPreview")),r(n),t.subscribe("pageNumberInputPreview")(function(e){n.currentPage=e.target.value,a(n.currentPage)}),t.subscribe("testPdfBtn")(e.export),a(n.currentPage)};a(),function n(){if(!e.DB||!e.DB.ready)return requestAnimationFrame(n);e.DB.runQuery().then(function(e){var n=t.element("previewQueryResults");if(n.innerHTML="",e){for(var r=0,i=function(){var t=r;N({parent:n,tag:"div",attributes:{className:"previewQueryResult",textContent:"item ".concat(r+1)},events:{click:function(r){var i=n.querySelector(".active");i&&i.classList.remove("active"),r.classList.add("active"),a(e[t])}}}),r+=1};e[r]&&r<10;)i();e.length&&t.element("testPdfBtn").classList.add("ready")}}).catch(console.log)}()})},te=function(e,t){t=t||12;for(var n=e||"",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=r.length,a=0;a<t;a++)n+=r.charAt(Math.floor(Math.random()*i));return n},ne=function(e){return e.selectedOptions[0]?e.selectedOptions[0].value:void 0},re=function(e,t){return N({tag:"div",attributes:{className:"inputContainer"},run:function(n){N({tag:"label",attributes:{textContent:"Value"},parent:n}),e.type.indexOf(" field")>-1?N({tag:"select",events:{input:function(t){return e.value=ne(t)?"{{".concat(e.type.split(" ")[0],".").concat(ne(t),"}}"):void 0}},parent:n,run:function(n){F({values:t.dbMetadata()[e.type.split(" ")[0]].keys,value:e.value,parent:n})}}):N({tag:"input",attributes:{value:e.value},events:{input:function(t){return e.value=t.value}},parent:n})}})},ie=function(e,t){return N({tag:"div",attributes:{className:"box",id:e.id},run:function(n){N({parent:n,tag:"div",attributes:{className:"section zebra"},run:function(n){!function(e,t){N({parent:t,tag:"div",attributes:{className:"inputContainer"},run:function(t){N({tag:"label",attributes:{textContent:"Field"},parent:t}),N({tag:"select",events:{input:function(t){return e.field=ne(t)}},parent:t,run:function(t){F({values:e.sourceMeta.keys,value:e.field,parent:t})}})}})}(e,n),function(e,t){N({parent:t,tag:"div",attributes:{className:"inputContainer"},run:function(t){N({tag:"label",attributes:{textContent:"Operator"},parent:t}),N({tag:"select",events:{input:function(t){return e.operator=ne(t)}},parent:t,run:function(t){F({values:e.operators,value:e.operator,parent:t})}})}})}(e,n),function(e,t,n){N({parent:n,tag:"div",attributes:{className:"inputContainer"},run:function(n){var r=e.types.slice(),a=t.getPath(e.id);if(a&&a.indexOf("joins")>-1){var o=[],s=a.split(".").slice(0,-3);s.forEach(function(e,n){for(var r=n,a=e;r--;)a="".concat(s[r],".").concat(a);var u=i(t.getSources(),a);u&&u.id&&0===u.id.indexOf("source")&&o.push(u.source)}),o.forEach(function(e){return r.push("".concat(e," field"))})}N({tag:"label",attributes:{textContent:"Value Type"},parent:n}),N({tag:"select",events:{input:function(t){e.type=ne(t)}},parent:n,run:function(t){F({values:r,value:e.type,parent:t})}})}})}(e,t,n),e.valueField=re(e,t),n.appendChild(e.valueField),N({parent:n,tag:"span",attributes:{textContent:"X",className:"modifyBtn danger"},events:{click:function(){return t.removeProp(e.id)}},run:function(e){return e.style.marginLeft="0.5rem"}})}})}})};var ae=function(e,t,n){var r=["equals","not equal to","contains","empty","not empty","greater than","greater than or equal to","less than","less than or equal to","in","not in"],a=["string","number","date","data"],o={field:new m(i(n,"field",e.keys[0])),operator:new m(i(n,"operator",r[0])),type:new m(i(n,"type",a[0])),value:new m(i(n,"value",""))},s=function(e){return o[e].value},u=function(e,t){return t===o[e].value?void 0:o[e].next(t)},c={id:te("query"),valueField:void 0,operators:r,types:a,sourceMeta:e,get field(){return s("field")},set field(e){u("field",e)},get operator(){return s("operator")},set operator(e){u("operator",e)},get type(){return s("type")},set type(e){u("type",e)},get value(){return s("value")},set value(e){u("value",e)},subscribe:function(e,t){return o[e].subscribe(t)},data:function(){return{field:c.field,operator:c.operator,type:c.type,value:c.value}},getQuery:function(){var e,t,n,r,i={};switch(c.type){case"string":e=c.value.toString();break;case"number":e=parseFloat(c.value);break;case"date":e=new Date(c.value).getTime();break;case"data":e=JSON.parse(c.value);break;default:e=c.value}switch(c.operator){case"equals":i={$eq:e};break;case"not equal to":i={$ne:e};break;case"empty":i={$exists:!1};break;case"not empty":i={$exists:!0};break;case"contains":i={$regex:".*".concat(e,".*")};break;case"greater than":i={$gt:e};break;case"greater than or equal to":i={$gte:e};break;case"less than":i={$lt:e};break;case"less than or equal to":i={$lte:e};break;case"in":i={$in:e};break;case"not in":i={$nin:e}}return t={},n=c.field,r=i,n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t},markup:function(){return ie(c,t)}};return o.type.subscribe(function(e){if(c.valueField){var n=c.valueField.parentElement,r=re(c,t);n.replaceChild(r,c.valueField),c.valueField=r}}),Object.keys(o).forEach(function(e){o[e].subscribe(t.save)}),c},oe=function(e,t,n){for(var r=0,i=function(){var i=r;N({parent:t,tag:"div",attributes:{className:"inputContainer processParam"},run:function(t){N({tag:"label",attributes:{textContent:n.params[i].name},parent:t}),N({tag:"input",attributes:{type:"text",value:n.params[i].value||""},parent:t,events:{input:function(t){n.params[i].value=t.value,e.save()}}})}}),r+=1};r<n.params.length;)i()},se=function(e,t,n){return N({parent:t,tag:"span",attributes:{textContent:"X",className:"modifyBtn danger"},events:{click:function(){return e.removeProcess(n.id)}}})},ue=function(e,t){return e.processContainer.appendChild(N({tag:"div",attributes:{className:"section",id:t.id},run:function(n){!function(e,t,n){N({parent:t,tag:"div",attributes:{className:"inputContainer"},run:function(r){N({tag:"label",attributes:{textContent:"Method"},parent:r}),N({tag:"select",events:{input:function(r){var i=r.selectedOptions[0]?r.selectedOptions[0].value:"";e.updateProcess(Object.assign({id:n.id},e.newProcessMethod(i)));var a=e.processes[e.getProcessIndex(n.id)];Array.from(t.querySelectorAll(".processParam")).forEach(function(e){return e.parentElement.removeChild(e)}),t.removeChild(t.querySelector(".modifyBtn.danger")),oe(e,t,a),se(e,t,a)}},parent:r,run:function(t){F({values:e.processMethods,value:n.name,parent:t})}})}})}(e,n,t),oe(e,n,t),se(e,n,t)}}))},ce=function(e){return N({tag:"div",attributes:{className:"outerSection box",id:e.id},run:function(t){N({tag:"div",attributes:{className:"section"},parent:t,run:function(t){!function(e,t){N({parent:t,tag:"div",attributes:{className:"inputContainer"},run:function(t){N({tag:"label",attributes:{textContent:"Field"},parent:t}),N({tag:"select",parent:t,events:{input:function(t){return e.field=function(e){return e.selectedOptions[0]?e.selectedOptions[0].value:void 0}(t)}},run:function(t){F({values:e.root.sourceMetadata().keys,value:e.field,parent:t})}})}})}(e,t),function(e,t){N({parent:t,tag:"div",attributes:{className:"inputContainer"},run:function(t){N({tag:"label",attributes:{textContent:"Rename"},parent:t}),N({tag:"input",attributes:{type:"text",value:e.name},parent:t,events:{input:function(t){e.name=t.value}}})}})}(e,t),function(e,t){N({parent:t,tag:"div",attributes:{className:"inputContainer"},run:function(t){N({tag:"label",attributes:{textContent:"Default value"},parent:t}),N({tag:"input",attributes:{type:"text",value:e.defaultValue},parent:t,events:{input:function(t){e.defaultValue=t.value}}})}})}(e,t),N({parent:t,tag:"span",attributes:{textContent:"X",className:"modifyBtn danger"},events:{click:function(){return e.root.removeProp(e.id)}},run:function(e){return e.style.marginLeft="0.5rem"}})}}),N({tag:"div",attributes:{className:"section"},parent:t,run:function(t){!function(e,t){N({parent:t,tag:"div",attributes:{className:"inputContainer"},run:function(t){N({tag:"label",parent:t,run:function(t){N({tag:"span",attributes:{textContent:"Processes "},parent:t,run:function(e){e.style.marginRight="0.25rem"}}),N({tag:"span",attributes:{textContent:"+",className:"modifyBtn"},parent:t,events:{click:e.newProcess},run:function(e){return e.style.marginLeft="0.5rem"}})}}),N({tag:"div",attributes:{className:"processContainer"},parent:t,run:function(t){return e.processContainer=t}})}})}(e,t)}})}})},le=function(e,t){var n={split:[{name:"delimiter",type:"string",value:""}],join:[{name:"glue",type:"string",value:""}],slice:[{name:"start",type:"number",value:0},{name:"end",type:"number",value:""}]},r={field:new m(i(t,"field",e.sourceMetadata().keys[0])),name:new m(i(t,"name","")),processes:new m([]),defaultValue:new m(i(t,"defaultValue",""))},a=function(e){return r[e].value},o=function(e,t){return t===r[e].value?void 0:r[e].next(t)},s={id:te("field"),processMethods:["split","join","slice"],processContainer:void 0,root:e,get field(){return a("field")},set field(e){o("field",e)},get name(){return a("name")},set name(e){o("name",e)},get processes(){return a("processes")},set processes(e){o("processes",e)},get defaultValue(){return a("defaultValue")},set defaultValue(e){o("defaultValue",e)},data:function(){return{name:s.name,field:s.field,defaultValue:s.defaultValue,processes:s.processes}},newProcessMethod:function(e){return{name:e,params:n[e].slice().map(function(e){return Object.assign({},e)})}},newProcess:function(e){var t=Object.assign({id:te("process")},s.newProcessMethod("split"),e);s.processes=s.processes.concat([t])},updateProcess:function(e){var t=s.getProcessIndex(e.id),n=s.processes.slice();n[t]=e,s.processes=n},getProcessIndex:function(e){for(var t=0,n=!1;!n;){if(s.processes[t].id===e){n=!0;break}t+=1}return t},removeProcess:function(e){var t=s.getProcessIndex(e),n=s.processes.slice(),r=document.getElementById(e);n.splice(t,1),r.parentElement.removeChild(r),s.processes=n},save:function(){return e.save()},markup:function(){var e=ce(s);return requestAnimationFrame(function(){t&&t.processes&&t.processes.forEach(s.newProcess)}),e}};return r.processes.subscribe(function(e){return function(e,t){e.processContainer&&(e.processContainer.innerHTML="",t.forEach(function(t){return ue(e,t)}))}(s,e)}),Object.keys(r).forEach(function(t){r[t].subscribe(e.save)}),s},fe=function(e,t){var n={name:new m(i(t,"name","")),value:new m(i(t,"value",""))},r=function(e){return n[e].value},a=function(e,t){return t===n[e].value?void 0:n[e].next(t)},o={id:te("customfield"),get name(){return r("name")},set name(e){a("name",e)},get value(){return r("value")},set value(e){a("value",e)},data:function(){return{name:o.name,value:o.value}},markup:function(){return N({tag:"div",attributes:{className:"outerSection box",id:o.id},run:function(t){N({tag:"div",attributes:{className:"section"},parent:t,run:function(t){s(t),u(t),N({parent:t,tag:"span",attributes:{textContent:"X",className:"modifyBtn danger"},events:{click:function(){return e.removeProp(o.id)}},run:function(e){return e.style.marginLeft="0.5rem"}})}})}})}},s=function(e){return N({parent:e,tag:"div",attributes:{className:"inputContainer"},run:function(e){N({tag:"label",attributes:{textContent:"Name"},parent:e}),N({tag:"input",attributes:{type:"text",value:o.name},parent:e,events:{input:function(e){o.name=e.value}}})}})},u=function(e){return N({parent:e,tag:"div",attributes:{className:"inputContainer"},run:function(e){N({tag:"label",attributes:{textContent:"Value"},parent:e}),N({tag:"input",attributes:{type:"text",value:o.value},parent:e,events:{input:function(e){o.value=e.value}}})}})};return Object.keys(n).forEach(function(t){n[t].subscribe(e.save)}),o},de=function(e,t,n){return N({parent:n,tag:"div",attributes:{className:"section"},run:function(n){!function(e,t){N({parent:t,tag:"div",attributes:{className:"inputContainer"},run:function(t){N({tag:"h3",attributes:{textContent:"Collection"},parent:t}),N({tag:"select",events:{input:function(t){return e.source=t.selectedOptions[0]?t.selectedOptions[0].value:void 0}},parent:t,run:function(t){return F({empty:"Select source collection",values:Object.keys(e.dbMetadata()),value:e.source,parent:t})}})}})}(e,n),t&&(function(e,t){N({parent:t,tag:"div",attributes:{className:"inputContainer"},run:function(t){t.style.alignSelf="flex-end",N({tag:"label",attributes:{textContent:"Name"},parent:t}),N({tag:"input",attributes:{placeholder:"name",type:"text",value:e.name},events:{input:function(t){e.name=t.value}},parent:t})}})}(e,n),function(e,t,n){N({parent:n,tag:"span",attributes:{textContent:"X",className:"modifyBtn danger"},events:{click:function(){return t.removeProp(e.id)}},run:function(e){return e.style.marginLeft="0.5rem"}})}(e,t,n))}})},pe=function(e,t){var n=N({tag:"div",attributes:{className:"dbSection",id:e.id},run:function(n){de(e,t,n),function(e,t){N({parent:t,tag:"div",attributes:{className:"modifyCollection"},run:function(t){N({tag:"div",attributes:{className:"section"},parent:t,run:function(t){N({tag:"h3",attributes:{textContent:"Query"},parent:t}),N({parent:t,tag:"span",attributes:{textContent:"+",className:"modifyBtn"},events:{click:e.addQuery}})}}),N({tag:"div",parent:t,run:function(t){e.setQueryContainer(t)}})}})}(e,n),function(e,t){N({parent:t,tag:"div",attributes:{className:"modifyCollection"},run:function(t){N({tag:"div",attributes:{className:"section"},parent:t,run:function(t){N({tag:"h3",attributes:{textContent:"Fields"},parent:t}),N({parent:t,tag:"span",attributes:{textContent:"+",className:"modifyBtn"},events:{click:e.addField}})}}),N({tag:"div",parent:t,run:function(t){e.setFieldsContainer(t)}})}})}(e,n),function(e,t){N({parent:t,tag:"div",attributes:{className:"modifyCollection"},run:function(t){N({tag:"div",attributes:{className:"section"},parent:t,run:function(t){N({tag:"h3",attributes:{textContent:"Custom fields"},parent:t}),N({parent:t,tag:"span",attributes:{textContent:"+",className:"modifyBtn"},events:{click:e.addCustomField}})}}),N({tag:"div",parent:t,run:function(t){e.setCustomFieldsContainer(t)}})}})}(e,n),function(e,t){N({parent:t,tag:"div",attributes:{className:"modifyCollection"},run:function(t){N({tag:"div",attributes:{className:"section"},parent:t,run:function(t){N({tag:"h3",attributes:{textContent:"Join collection"},parent:t}),N({parent:t,tag:"span",attributes:{textContent:"+",className:"modifyBtn"},events:{click:e.addJoin}})}}),N({tag:"div",parent:t,run:function(t){e.setJoinContainer(t)}})}})}(e,n),function(e,t,n){t||N({parent:n,tag:"div",attributes:{className:"modifyCollection"},run:function(t){N({tag:"div",attributes:{className:"section"},parent:t,run:function(e){N({tag:"h3",attributes:{textContent:"Expression"},parent:e})}}),N({tag:"textarea",parent:t,events:{input:function(t){return e.expression=t.value}}}),e.setExpressionContainer(t)}})}(e,t,n)}});return requestAnimationFrame(function(){["queries","fields","customFields","joins"].map(function(t){return e.subscribe(t,function(n){var r=function(n,r){return e.getContainer(t).insertBefore(n.markup(),e.getElements(t)[r])};for(n.forEach(function(n,i){if(e.getElements(t)[i]){if(e.getElements(t)[i].id!==n.id)return r(n,i)}else r(n,i)});e.getElements(t).length>n.length;){var i=e.getElements(t),a=i[i.length-1];e.getContainer(t).removeChild(a)}})})}),n},be=function e(t,n,r){var a={queries:void 0,fields:void 0,customFields:void 0,joins:void 0,expression:void 0},o={name:new m(i(n,"name","")),source:new m(i(n,"source","")),queries:new m([]),fields:new m([]),customFields:new m([]),joins:new m([]),expression:new m(i(n,"properties.expression",""))},s=function(e){return o[e].value},u=function(e,t){return t===o[e].value?void 0:o[e].next(t)},c={id:te("source"),dbMetadata:function(){return t.metadata},sourceMetadata:function(){return t.metadata[c.source]},get name(){return s("name")},set name(e){u("name",e)},get source(){return s("source")},set source(e){u("source",e)},get queries(){return s("queries")},set queries(e){u("queries",e)},get fields(){return s("fields")},set fields(e){u("fields",e)},get customFields(){return s("customFields")},set customFields(e){u("customFields",e)},get joins(){return s("joins")},set joins(e){u("joins",e)},get expression(){return s("expression")},set expression(e){u("expression",e)},setQueryContainer:function(e){a.queries=e},setFieldsContainer:function(e){a.fields=e},setCustomFieldsContainer:function(e){a.customFields=e},setJoinContainer:function(e){a.joins=e},setExpressionContainer:function(e){a.expression=e},getPath:function(e){return t.getPath(e)},getSources:function(){return t.sources},subscribe:function(e,t){return o[e].subscribe(t)},getElements:function(e){return a[e]?Array.from(a[e].children):[]},getContainer:function(e){return a[e]},markup:function(){var e=pe(c,r);return c.showHideFields(),n&&n.properties&&Object.keys(n.properties).forEach(function(e){n.properties[e]&&("expression"!==e?n.properties[e].forEach(function(t){switch(e){case"queries":c.addQuery(t);break;case"fields":c.addField(t);break;case"customFields":c.addCustomField(t);break;case"joins":c.addJoin(t)}}):a.expression.querySelector("textarea").value=n.properties[e])}),e},data:function(){return{name:r?c.name:c.source,source:c.source,properties:{queries:c.queries.map(function(e){return e.data()}),fields:c.fields.map(function(e){return e.data()}),customFields:c.customFields.map(function(e){return e.data()}),joins:c.joins.map(function(e){return e.data()}),expression:c.expression}}},getData:function(){return{query:c.getQuery(),fields:c.getFields(),customFields:c.getCustomFields(),joins:c.joins.map(function(e){return e.getData()}),expression:c.expression}},addJoin:function(n){c.joins=c.joins.concat([e(t,n,c)])},addField:function(e){c.fields=c.fields.concat([le(c,e)])},addCustomField:function(e){c.customFields=c.customFields.concat([fe(c,e)])},addQuery:function(e){c.queries=c.queries.concat([ae(c.sourceMetadata(),c,e)])},getFields:function(){return c.fields.map(function(e){return{defaultValue:e.defaultValue,field:e.field,name:e.name||e.field,processes:e.processes.slice()}})},getCustomFields:function(){return c.customFields.map(function(e){return{name:e.name,value:e.value}})},getQuery:function(){var e={};return c.queries.forEach(function(t){return e=Object.assign({},e,t.getQuery())}),{collection:c.source,name:c.name||c.source,queries:e}},removeProp:function(e){var n=t.getPath(e);if(n){var r=n.split("."),i=r.pop(),a=r.pop(),o=c[a].slice(),s=document.getElementById(e);o.splice(i,1),s.parentElement.removeChild(s),c[a]=o}},save:function(){t.save()},clear:function(){c.queries=[],c.fields=[],c.customFields=[],c.joins=[],c.showHideFields()},showHideFields:function(){var e="remove";c.source&&(e="add"),Object.keys(a).forEach(function(t){a[t]&&a[t].parentElement&&("expression"===t&&a[t].classList[e]("active"),"remove"===e&&(a[t].innerHTML=""),a[t].parentElement.classList[e]("active"))})}};return o.source.subscribe(c.clear),Object.keys(o).forEach(function(e){o[e].subscribe(c.save)}),c},ge=function(e,t,n,r){var i=new m(n),o=new m(t),s={get data(){return o.value},set data(e){o.next(e)},get metadata(){return i.value},set metadata(e){i.next(e)},ready:!1,sources:[],getPath:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.sources,r=0;r<n.length;r++){if(n[r].id===e)return"".concat(t).concat(r);var i=!!n[r].joins&&s.getPath(e,"".concat(t).concat(r,".joins."),n[r].joins);if(i)return i;var a=!!n[r].fields&&s.getPath(e,"".concat(t).concat(r,".fields."),n[r].fields);if(a)return a;var o=!!n[r].customFields&&s.getPath(e,"".concat(t).concat(r,".customFields."),n[r].customFields);if(o)return o;var u=!!n[r].queries&&s.getPath(e,"".concat(t).concat(r,".queries."),n[r].queries);if(u)return u}},newSource:function(){e.innerHTML="";var t=be(s,s.data);s.sources.push(t),e.appendChild(t.markup()),setTimeout(function(){s.ready=!0},1e3)},getQuery:function(){return s.sources.map(function(e){return e.getData()})[0]},runQuery:function(){var e=s.sources.map(function(e){return e.getData()})[0];return a({path:"query/get",data:JSON.stringify(e)})},save:function(){s.sources&&s.sources[0]&&r(s.sources[0].data())}};return s.newSource(),s};O().then(function e(t){if(t){I(t,e),Z(t),ee(t);var n=K(t);a({path:"query/init"}).then(function(e){t.DB=new ge(n.element("queryContainer"),t.data,e,function(e){t.data=e,t.save()})}),Object.keys(h.tabs).forEach(function(e,n){return t.subscriptions["tabsclick".concat(n)]=L(h.tabs[e],"click").subscribe(function(){console.log("tab",e),t.tab=e})}),t.subscribeTab(w),t.initialized$(e),console.log("state",t)}})}]);